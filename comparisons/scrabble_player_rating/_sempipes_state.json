{
    "generated_code": [
        "\nimport pandas as pd\nimport numpy as np\n\n# (Opponent-relative and efficiency metrics at the game level)\n# Usefulness: These temporary features are crucial for building powerful player-level aggregates. 'score_difference' directly measures game dominance, while 'score_per_turn' measures scoring efficiency. These are fundamental indicators of player skill within the context of a single game.\n# Input samples: 'game_id': [np.int64(1), np.int64(1), np.int64(3)], 'score': [np.int64(335), np.int64(429), np.int64(440)], 'total_turns': [np.int64(13), np.int64(14), np.int64(14)]\ndf['total_game_score'] = df.groupby('game_id')['score'].transform('sum')\ndf['opponent_score'] = df['total_game_score'] - df['score']\ndf['score_difference'] = df['score'] - df['opponent_score']\ndf['score_per_turn'] = df['score'] / df['total_turns'].replace(0, 1)\ndf['is_first'] = (df['nickname'] == df['first']).astype(int)\n\n# (Player-level aggregated performance statistics)\n# Usefulness: Aggregating performance across all of a player's games provides a stable and robust measure of their overall skill. A high win rate, average score, and average score difference are strong predictors of a high rating. Standard deviation captures consistency.\n# Input samples: 'nickname': ['BetterBot', 'stevy', 'davidavid'], 'winner': [np.int64(1), np.int64(1), np.int64(1)], 'score': [np.int64(335), np.int64(429), np.int64(440)], 'score_difference': [-94, 94, 122]\nplayer_stats = df.groupby('nickname').agg(\n    player_games_played=('game_id', 'count'),\n    player_win_rate=('winner', 'mean'),\n    player_avg_score=('score', 'mean'),\n    player_std_score=('score', 'std'),\n    player_avg_score_difference=('score_difference', 'mean'),\n    player_std_score_difference=('score_difference', 'std'),\n    player_avg_score_per_turn=('score_per_turn', 'mean')\n).reset_index()\n\n# (Player performance based on turn order)\n# Usefulness: This feature quantifies a player's ability to leverage the first-move advantage. A large positive value indicates a player who is skilled at opening strategy and converting the initial advantage into a win, which is a sign of a higher-rated player.\n# Input samples: 'nickname': ['BetterBot', 'stevy', 'davidavid'], 'is_first': [1, 0, 0], 'winner': [1, 1, 1]\nwin_rates_by_turn = df.groupby(['nickname', 'is_first'])['winner'].mean().unstack(fill_value=np.nan)\nwin_rates_by_turn.columns = ['win_rate_second', 'win_rate_first']\nplayer_stats = player_stats.merge(win_rates_by_turn, on='nickname', how='left')\nplayer_stats['win_rate_first'].fillna(player_stats['player_win_rate'], inplace=True)\nplayer_stats['win_rate_second'].fillna(player_stats['player_win_rate'], inplace=True)\nplayer_stats['player_first_move_win_advantage'] = player_stats['win_rate_first'] - player_stats['win_rate_second']\n\n# (Player performance in rated games)\n# Usefulness: Performance in 'RATED' games is a more accurate reflection of a player's true skill level than in 'CASUAL' games. A high win rate in rated games is a very strong signal for a high rating.\n# Input samples: 'nickname': ['davidavid', 'BetterBot', 'HivinD'], 'rating_mode': ['RATED', 'RATED', 'RATED'], 'winner': [1, 1, 0]\nrated_games_df = df[df['rating_mode'] == 'RATED']\nplayer_rated_stats = rated_games_df.groupby('nickname').agg(\n    player_rated_games_played=('game_id', 'count'),\n    player_rated_win_rate=('winner', 'mean')\n).reset_index()\nplayer_stats = player_stats.merge(player_rated_stats, on='nickname', how='left')\nplayer_stats['player_rated_games_played'].fillna(0, inplace=True)\nplayer_stats['player_rated_win_rate'].fillna(player_stats['player_win_rate'], inplace=True)\n\n# (Merge all player-level features back and clean up)\n# Usefulness: This step adds the rich, aggregated player-level context to each individual game row, making the information available to the model. Cleaning up removes redundant or intermediate columns.\ndf = df.merge(player_stats, on='nickname', how='left')\ndf['player_std_score'].fillna(0, inplace=True)\ndf['player_std_score_difference'].fillna(0, inplace=True)\ndf.drop(columns=['total_game_score', 'opponent_score', 'score_difference', 'score_per_turn', 'is_first', 'win_rate_first', 'win_rate_second'], inplace=True)\n"
    ]
}